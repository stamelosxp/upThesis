<%
function formatDate(dateString) {
    if (!dateString) return '';
    const dateObj = new Date(dateString);
    if (isNaN(dateObj.getTime())) return '';
    const day = String(dateObj.getDate()).padStart(2, '0');
    const month = String(dateObj.getMonth() + 1).padStart(2, '0');
    const year = dateObj.getFullYear();
    return `${day}/${month}/${year}`;
}
%>
<div class="topic-item-expanded hidden" data-topic-id="<%= topic.id %>">
    <div class="topic-form-group">
        <label for="topic-input-title-<%= topic.id %>" id="label-topic-input-title-<%= topic.id %>">
            <div class="topic-header">
                <div>
                    Τίτλος Θέματος <span class="warning-message"></span>
                </div>
                <p class="simple-badge"><%= formatDate(topic.creationDate) %></p>
            </div>
        </label>
        <input
                class="input-class hidden"
                type="text"
                id="topic-input-title-<%= topic.id %>"
                value="<%= topic.title %>"
                data-original-value="<%= topic.title %>"
                required
                readonly
        />
        <p class="group-value"><%= topic.title %></p>
    </div>

    <div class="topic-form-group">
        <label for="topic-input-desc-<%= topic.id %>" id="label-topic-input-desc-<%= topic.id %>">Περιγραφή <span class="warning-message"></span></label>
        <textarea
                id="topic-input-desc-<%= topic.id %>"
                maxlength="510"
                required
                disabled
                data-original-value="<%= topic.description %>"
        ><%= topic.description %></textarea>
    </div>

    <div class="topic-form-group file">
        <label>Συννημένο</label>
        <% if (topic.filePath) { %>

            <% const reqFileName = topic.filePath.split('/').pop(); const reqFileExt = (reqFileName && reqFileName.includes('.') ? reqFileName.split('.').pop().toUpperCase() : ''); %>
            <p class="topic-file-exists">
                <a href="<%= topic.filePath %>" target="_blank" class="attachment-link" title="<%= reqFileName %>">
                    <span class="attachment-icon">📄</span>
                    <span class="name-content"><%= reqFileName %></span>
                    <span class="attachment-type"><%= reqFileExt %></span>
                </a>
                <% if(locals.connectedUserRole === 'professor') { %>
                    <button class="x-icon">&times;</button>
                <% } %>

            </p>

            <input
                    type="file"
                    id="update-topic-file-<%= topic.id %>"
                    accept=".pdf,.doc,.docx,.txt"
                    class="update-file-input"
                    data-original-value="<%= topic.filePath %>"
                    readonly
                    hidden
            />

        <% } else { %>
            <% if(locals.connectedUserRole === 'professor') { %>
                <input
                        type="file"
                        id="topic-file-<%= topic.id %>"
                        accept=".pdf,.doc,.docx,.txt"
                        class="file-input"
                        data-original-value=""
                        readonly
                />
            <% } else { %>
                <input
                        type="text"
                        value="-"
                        readonly

                />
            <% } %>
        <% } %>
    </div>

    <% if(locals.connectedUserRole === 'professor') { %>
        <div class="topic-form-group">
            <label >Ανάθεση</label>
            <input
                    id="topic-assignment-<%= topic.id %>"
                    placeholder="Επιλέξτε Φοιτητή για Ανάθεση"
                    class="assignment"
                    value=""
                    data-assignment-id="<%= topic.id %>"
                    data-original-value=""
                    data-student-assigned-id=""
                    readonly
            />
        </div>


        <div class="topic-buttons-group">
            <button class="cancel-button delete-topic-button" id="delete-topic-button-<%= topic.id %>">Διαγραφή</button>
            <button class="light-button edit-topic-button" id="edit-topic-button-<%= topic.id %>">Επεξεργασία</button>
        </div>


        <div class="edit-topic-buttons-group">
            <button class="light-button cancel-edit-button" id="cancel-topic-button-<%= topic.id %>">Ακύρωση
            </button>
            <button class="accept-button hidden" id="submit-topic-button-<%= topic.id %>">Αποθήκευση</button>
        </div>

    <% } else { %>
        <div class="topic-form-group">
            <label>Επιβλέπων</label>
            <input
                    type="text"
                    value="Αλεξίου Δημήτριος"
                    readonly
            />
        </div>
    <% } %>

    <small class="collapse-button">Κλικ για σύμπτυξη</small>
</div>